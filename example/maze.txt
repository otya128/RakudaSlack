basic:
BGWIDTH=101
BGHEIGHT=101
SWIDTH=10
SHEIGHT=10
CHIPSIZE=16
GOSUB@BGINIT
CHIP$[0]=":white:"
CHIP$[1]=":block:"
HEIGHT=BGHEIGHT
WIDTH=BGWIDTH
LET MX=WIDTH-2
LET MY=HEIGHT-2
FOR X=0TO WIDTH-1
LET BG[X]=1
LET BG[X+(HEIGHT-1)*WIDTH]=1
NEXT
FOR Y=0TO HEIGHT-1
LET BG[Y*WIDTH]=1
LET BG[WIDTH-1+Y*WIDTH]=1
NEXT
LET BG[1]=0
GOSUB@GENMAZE
LET VOID\$=CALL("onposted", MAKEPROCINSTANCE "@ONPOSTED")
LET VOID\$=CALL("onreaction", MAKEPROCINSTANCE "@ONREACTION")
LET VOID\$=CALL("onreactionremoved", MAKEPROCINSTANCE "@ONREACTION")
GOSUB@UPDATECAMERA
GOSUB@BGRENDER
GOSUB@PLAYERRENDER
GOSUB@FLUSH
GOTO@END
@UPDATECAMERA
BGX=MX-SWIDTH/2
BGY=MY-SHEIGHT/2
IF MX+SWIDTH/2>=BGWIDTH THEN BGX=BGWIDTH-SWIDTH
IF MY+SHEIGHT/2>=BGHEIGHT THEN BGY=BGHEIGHT-SHEIGHT
BGX=-BGX
BGY=-BGY
RETURN
@ONPOSTED
LET VOID\$=CALL("addreaction", "point_left")
LET VOID\$=CALL("addreaction", "point_right")
LET VOID\$=CALL("addreaction", "point_up")
LET VOID\$=CALL("addreaction", "point_down")
GOTO@END
@ONREACTION
LET OX=MX
LET OY=MY
LET MX=MX-(A1$="point_left")
LET MX=MX+(A1$="point_right")
LET MY=MY-(A1$="point_up")
LET MY=MY+(A1$="point_down")
IF BG[MX+MY*WIDTH] THEN LET MX=OX:LET MY=OY
GOSUB@UPDATECAMERA
GOSUB@BGRENDER
GOSUB@PLAYERRENDER
GOSUB@FLUSH
IF (MX=1)*(MY=0) THEN ?"!"
GOTO@END
@PLAYERRENDER
SCREEN$[MX+BGX+SWIDTH*(MY+BGY)]=":player:"
RETURN
@GENMAZE
FOR Y=2TO HEIGHT-1 STEP 2
FOR X=2TO WIDTH-1 STEP 2
BG[X+Y*WIDTH]=1
NEXT
NEXT
K=4
FOR Y=2TO HEIGHT-3 STEP 2
FOR X=2TO WIDTH-3 STEP 2
@10
X2=X
Y2=Y
R=INT(RND()*K)
IF R=0 THEN X2=X2+1
IF R=1 THEN Y2=Y2+1
IF R=2 THEN X2=X2-1
IF R=3 THEN Y2=Y2-1
IF BG[X2+Y2*WIDTH] THEN GOTO@10
BG[X2+Y2*WIDTH]=1
NEXT
K=3
NEXT
RETURN
@BGINIT
BG=DIMNUM(BGWIDTH*BGHEIGHT)
CHIP$=DIMSTR(CHIPSIZE)
BGX=0
BGY=0
RETURN
@CLS
SCREEN$=DIMSTR(SWIDTH*SHEIGHT)
RETURN
@BGRENDER
GOSUB@CLS
FOR Y=0 TO BGHEIGHT-1
FOR X=0 TO BGWIDTH-1
IF X+BGX<0THEN GOTO@BGRENDERCONT
IF Y+BGY<0THEN GOTO@BGRENDERCONT
IF X+BGX>=SWIDTH THEN GOTO@BGRENDERCONT
IF Y+BGY>=SHEIGHT THEN GOTO@BGRENDERCONT
SCREEN$[X+BGX+SWIDTH*(Y+BGY)]=CHIP$[BG[X+BGWIDTH*Y]]
@BGRENDERCONT
NEXT
NEXT
RETURN
@FLUSH
FOR Y=0 TO SHEIGHT-1
FOR X=0 TO SWIDTH-1
?SCREEN$[X+SWIDTH*Y];
NEXT
?""
NEXT
RETURN
@END
